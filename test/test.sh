#!/bin/bash

_PURPLE="\033[35m"
_CYAN="\033[36m"
_END="\033[0m"

if [ "$1" = "unit" -o -z "$1" ]; then
(
    printf "$_PURPLE"
    echo ""
    echo "     :::    ::: ::::    ::: ::::::::::: ::::::::::: ::::::::::: :::::::::: :::::::: ::::::::::: "
    echo "    :+:    :+: :+:+:   :+:     :+:         :+:         :+:     :+:       :+:    :+:    :+:      "
    echo "   +:+    +:+ :+:+:+  +:+     +:+         +:+         +:+     +:+       +:+           +:+       "
    echo "  +#+    +:+ +#+ +:+ +#+     +#+         +#+         +#+     +#++:++#  +#++:++#++    +#+        "
    echo " +#+    +#+ +#+  +#+#+#     +#+         +#+         +#+     +#+              +#+    +#+         "
    echo "#+#    #+# #+#   #+#+#     #+#         #+#         #+#     #+#       #+#    #+#    #+#          "
    echo "########  ###    #### ###########     ###         ###     ########## ########     ###           "
    printf "$_END"
    echo ""

    cmake -S . -B build
    cmake --build build
    cd build && ctest
    if [ $? -ne 0 ]; then
    	./WebservTest
    fi

    if [ $? -ne 0 ]; then
        exit 1
    fi
)
fi

if [ "$1" = "http" -o -z "$1" ]; then
(
    printf "$_CYAN"
    echo ""
    echo "      :::    ::: ::::::::::: ::::::::::: ::::::::: ::::::::::: :::::::::: :::::::: ::::::::::: "
    echo "     :+:    :+:     :+:         :+:     :+:    :+:    :+:     :+:       :+:    :+:    :+:      "
    echo "    +:+    +:+     +:+         +:+     +:+    +:+    +:+     +:+       +:+           +:+       "
    echo "   +#++:++#++     +#+         +#+     +#++:++#+     +#+     +#++:++#  +#++:++#++    +#+        "
    echo "  +#+    +#+     +#+         +#+     +#+           +#+     +#+              +#+    +#+         "
    echo " #+#    #+#     #+#         #+#     #+#           #+#     #+#       #+#    #+#    #+#          "
    echo "###    ###     ###         ###     ###           ###     ########## ########     ###           "
    echo ""
    printf "$_END"

    cd ../
    make
    ./test/http/httptest

    if [ $? -eq 0 ]; then
        exit 0
    else
        exit 1
    fi
)
fi
